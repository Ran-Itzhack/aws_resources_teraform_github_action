#  [Configuration] => [Data Source Query] => [Cloud Provider API] => [Returns Current Data ] => [ Use in Resources ]

data "aws_vpc" "default_vpc" {
  # default = true

  # OR

  id = "vpc-ee9f0e85"
}

output "default_vpc_id" {
  value = data.aws_vpc.default_vpc
}

# Define a variable for the existing VPC ID
variable "vpc_id" {
  description = "The ID of the existing VPC"
  type        = string
}

# 1. Query all subnets in the specified VPC using the aws_subnets data source
data "aws_subnets" "example" {
  filter {
    name   = "vpc-id"
    values = [var.vpc_id]
  }
}

# 2. Retrieve detailed information for each subnet using the aws_subnet data source with a for_each loop
data "aws_subnet" "example" {
  for_each = toset(data.aws_subnets.example.ids)
  id       = each.value
}

# 3. Output the desired attributes (e.g., CIDR blocks, Availability Zones, Subnet IDs)
output "subnet_details" {
  description = "Details for all subnets in the VPC"
  value = {
    for s in data.aws_subnet.example : s.id => {
      cidr_block        = s.cidr_block
      availability_zone = s.availability_zone
      # Add other attributes as needed
    }
  }
}

output "subnet_cidr_blocks" {
  description = "A list of all subnet CIDR blocks"
  value       = [for s in data.aws_subnet.example : s.cidr_block]
}

output "subnet_ids" {
  description = "A list of all subnet IDs"
  value       = data.aws_subnets.example.ids
}

resource "null_resource" "create_file_localy" {
  provisioner "local-exec" {

    # command = "echo 'Automate AWS Infra Deployment ${join(", ", data.aws_subnets.example.ids)} using Terraform...' > hello.txt"
    # command = "echo -e 'Automate AWS Infra Deployment\n${join(", ", data.aws_subnets.example.ids)}\nusing Terraform and GitHub Actions Workflows' > hello.txt"
    command = <<EOT
                  echo 'aws_subnets.example.ids: 
                  ${join(", ", data.aws_subnets.example.ids)}
                  using Terraform.' > hello.txt
              EOT
  }
}
